<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>pycyberdb Live Login</title>
    <style>
      *,
      *:after,
      *:before {
        box-sizing: border-box;
      }

      /* Base Layout & Theme */
      body {
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #121921; /* Dark background */
        margin: 0;
        font-family: 'Inter', system-ui, -apple-system, sans-serif;
        color: #f8fafc;
        padding: 1rem;
        overflow: hidden; /* Prevent scrollbars from background movement */
      }

      /* Full-Screen Canvas for Animation */
      #cyber-canvas {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 1; /* Below the content */
        filter: brightness(0.7); /* Slightly dim the background glow */
      }

      /* Content Wrapper (Login Card and UI elements) */
      .content-wrapper {
        position: relative;
        z-index: 10; /* Ensures content sits on top of the canvas */
        display: flex;
        align-items: center;
        justify-content: center;
        width: 100%;
        height: 100%;
        transition: opacity 0.5s ease-in-out; 
      }

      /* Close Button Styling */
      .close-btn {
        position: fixed;
        top: 1.5rem;
        right: 1.5rem;
        width: 44px;
        height: 44px;
        background: #334155;
        color: #e2e8f0;
        border: none;
        border-radius: 50%;
        font-size: 1.6rem;
        line-height: 1;
        font-weight: 300;
        cursor: pointer;
        z-index: 20; 
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background 0.2s, transform 0.3s ease-out;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
      }

      .close-btn:hover {
        background: #475569;
        transform: rotate(90deg) scale(1.05);
      }
      
      .close-btn svg {
          width: 24px;
          height: 24px;
          stroke: currentColor;
          stroke-width: 2.5;
      }

      /* Screen Transition Overlay (Initial State) */
      .screen-transition {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #4f46e5; /* Primary indigo color */
        z-index: 100;
        pointer-events: none;
        opacity: 0;
        transition: opacity 0.5s ease-in-out;
      }

      /* Screen Transition Overlay (Animation State) */
      .screen-transition.animate-out {
        opacity: 1;
      }

      /* Login Card Styling */
      .login-card {
        background: rgba(30, 41, 59, 0.9);
        backdrop-filter: blur(5px);
        padding: 3rem;
        border-radius: 16px;
        min-width: 320px;
        max-width: 440px;
        width: 100%;
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.7), 0 0 10px rgba(79, 70, 229, 0.5);
        border: 1px solid #334155;
        z-index: 10;
        transition: opacity 0.5s ease-in-out; /* Added transition for smooth fading */
      }

      /* Form Elements (unchanged styles for inputs/buttons) */
      .form-group { margin-bottom: 1.25rem; }
      .form-group label { display: block; color: #94a3b8; margin-bottom: 6px; font-size: 0.9rem; font-weight: 600; }
      .form-group input {
        width: 100%; padding: 0.75rem 1rem; border-radius: 10px; border: 2px solid #334155;
        background: #0f172a; color: #f8fafc; transition: border-color 0.2s, box-shadow 0.2s;
      }
      .form-group input:focus {
        border-color: #6366f1; box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.5); outline: none;
      }
      .login-btn {
        width: 100%; padding: 0.875rem; background: #4f46e5; border: none;
        border-radius: 10px; color: #fff; font-size: 1rem; font-weight: 600;
        cursor: pointer; transition: background-color 0.2s, transform 0.1s;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3); margin-top: 1rem;
      }
      .login-btn:hover { background: #4338ca; transform: translateY(-1px); }
      .login-btn:active { transform: translateY(0); }
      .form-footer { margin-top: 1.5rem; text-align: center; }
      .forgot-link { color: #94a3b8; font-size: 0.9rem; text-decoration: none; transition: color 0.2s; }
      .forgot-link:hover { color: #a5b4fc; }
      .message-box {
        padding: 12px; border-radius: 8px; margin-bottom: 15px; font-size: 0.9rem;
        font-weight: 500; text-align: center; opacity: 0; height: auto;
        min-height: 40px; transition: opacity 0.3s;
      }
      .message-box.active { opacity: 1; }
      .message-box.error { background: #fee2e2; color: #991b1b; }
      .message-box.success { background: #dcfce7; color: #166534; }

      /* --- SUCCESS DISPLAY STYLES --- */
      #success-display {
          position: absolute; /* Allows it to occupy the same space as the login card */
          opacity: 0;
          visibility: hidden;
          transition: opacity 0.5s ease-in-out;
          font-size: 2rem;
          font-weight: 700;
          text-align: center;
          color: #34d399; /* Bright green from the logo design */
          text-shadow: 0 0 20px rgba(52, 211, 153, 0.8);
          max-width: 440px;
          padding: 3rem;
      }
      #success-display.visible {
          opacity: 1;
          visibility: visible;
      }

    </style>
  </head>
  <body>
    
    <!-- CANVAS FOR ANIMATED BACKGROUND (Z-INDEX 1) -->
    <canvas id="cyber-canvas"></canvas>

    <!-- UI ELEMENTS & LOGIN CARD (Z-INDEX 10+) -->
    <div class="content-wrapper" id="content-wrapper">
      
      <!-- Back/Close Button (X) using SVG -->
      <button class="close-btn" onclick="handleBack()">
          <!-- Clean SVG 'X' icon -->
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" fill="none">
              <path d="M200 56L56 200M200 200L56 56" stroke="#e2e8f0" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
      </button>
      
      <!-- The centered login card -->
      <div class="login-card" id="loginCard">

        <h2>Account Login</h2>

        <!-- Message Box for feedback (instead of alerts) -->
        <div id="message-box" class="message-box" aria-live="polite"></div>

        <form id="loginForm">
          <div class="form-group">
            <label for="email">Email Address</label>
            <input
              id="email"
              name="email"
              type="email"
              placeholder="you@example.com"
              required
            />
          </div>
          <div class="form-group">
            <label for="password">Password</label>
            <input
              id="password"
              name="password"
              type="password"
              placeholder="Your secret password"
              required
            />
          </div>
          <button type="submit" class="login-btn">Sign In</button>
          <div class="form-footer">
            <a class="forgot-link" href="#">Forgot Password?</a>
            <div style="margin-top: 12px">
              <a class="forgot-link" href="#">
                Don't have an account? Register here
              </a>
            </div>
          </div>
        </form>
      </div>

      <!-- SUCCESS MESSAGE DISPLAY (Initially Hidden) -->
      <div id="success-display">
          Hello, Login Successful
      </div>
    </div>

    <!-- Screen Transition Overlay (Initially hidden, Z-INDEX 100) -->
    <div id="transition-overlay" class="screen-transition"></div>

    <!-- Firebase SDK Imports (Module setup remains the same) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Global variables provided by the environment
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        if (Object.keys(firebaseConfig).length > 0) {
            setLogLevel('Debug');
            const app = initializeApp(firebaseConfig);
            window.db = getFirestore(app);
            window.auth = getAuth(app);

            // Attempt to sign in with custom token or anonymously
            (async () => {
                try {
                    if (initialAuthToken) {
                        await signInWithCustomToken(window.auth, initialAuthToken);
                        console.log("Firebase signed in with custom token.");
                    } else {
                        await signInAnonymously(window.auth);
                        console.log("Firebase signed in anonymously.");
                    }
                    window.userId = window.auth.currentUser?.uid || crypto.randomUUID();
                } catch (error) {
                    console.error("Firebase Auth Error:", error);
                }
            })();
        } else {
             console.warn("Firebase configuration is missing. Skipping initialization.");
             window.userId = crypto.randomUUID();
        }
    </script>
    
    <script>
      const canvas = document.getElementById('cyber-canvas');
      const ctx = canvas.getContext('2d');
      var W, H;
      const trails = [];
      const TRAIL_COUNT = 3;

      // --- Animation Setup and Functions (Unchanged) ---

      /**
       * Resize canvas to fill window and update dimensions.
       */
      function resizeCanvas() {
        W = window.innerWidth;
        H = window.innerHeight;
        canvas.width = W;
        canvas.height = H;
        // Re-initialize trails on resize to adapt their amplitude/yOffset to the new H
        initTrails(); 
      }
      window.addEventListener('resize', resizeCanvas);
      resizeCanvas(); 

      /**
       * Initialize the data/snake trails.
       */
      function initTrails() {
        trails.length = 0; // Clear existing
        for (let i = 0; i < TRAIL_COUNT; i++) {
          trails.push({
            // Colors from the pycyberdb logo concept
            color: i % 3 === 0 ? 'rgba(79, 70, 229, 0.8)' : 
                   i % 3 === 1 ? 'rgba(34, 197, 94, 0.8)' : 
                                 'rgba(167, 139, 250, 0.8)',
            speed: (0.5 + Math.random()) * 0.5,
            amplitude: (H / 4) + (Math.random() * (H / 6)),
            frequency: 0.0005 + Math.random() * 0.0005,
            yOffset: H / 2 + (i - TRAIL_COUNT / 2) * 50
          });
        }
      }

      /**
       * Main animation loop.
       */
      function animate(time) {
        requestAnimationFrame(animate);

        // Slow fade effect for a trailing background
        ctx.fillStyle = 'rgba(18, 25, 33, 0.1)'; 
        ctx.fillRect(0, 0, W, H);

        trails.forEach(trail => {
          ctx.beginPath();
          ctx.strokeStyle = trail.color;
          ctx.lineWidth = 2;
          ctx.shadowBlur = 15;
          ctx.shadowColor = trail.color;

          // Start off-screen
          ctx.moveTo(-10, trail.yOffset); 

          for (let x = -10; x <= W + 10; x += 5) {
            // Sinusoidal movement (the "snake" movement)
            const y = trail.yOffset + 
                      Math.sin(x * trail.frequency + time * trail.speed * 0.005) * trail.amplitude * Math.sin(time * 0.0001);

            ctx.lineTo(x, y);
          }
          ctx.stroke();
          
          // Clear shadow for next trail draw
          ctx.shadowBlur = 0;
        });
      }
      // Start the animation loop
      animate(0);


      // --- UI & Form Functions ---

      function handleBack() {
          const overlay = document.getElementById('transition-overlay');
          const loginCard = document.getElementById('loginCard');
          const successDisplay = document.getElementById('success-display');
          const messageBox = document.getElementById('message-box');


          // 1. Start the animation (fade to full screen color)
          overlay.classList.add('animate-out');
          document.body.style.pointerEvents = 'none';

          // 2. Wait for the animation to complete (0.5s in CSS)
          setTimeout(() => {
              // 3. Reset UI elements silently: Hide success, show login card
              overlay.classList.remove('animate-out');
              
              // Resetting visibility and opacity for login card
              loginCard.style.opacity = 1;
              loginCard.style.visibility = 'visible';

              // Hiding success message
              successDisplay.classList.remove('visible');
              
              // Clear message box
              messageBox.classList.remove('active');
              messageBox.textContent = '';


              document.body.style.pointerEvents = 'auto'; // Restore interaction
              
          }, 500); 
      }

      // Simple JavaScript for mock form handling and message display
      document
        .getElementById('loginForm')
        .addEventListener('submit', function (event) {
          event.preventDefault(); 

          const email = document.getElementById('email').value.trim();
          const password = document.getElementById('password').value.trim();
          const messageBox = document.getElementById('message-box');
          const loginCard = document.getElementById('loginCard');
          const successDisplay = document.getElementById('success-display');
          
          // Clear previous messages
          messageBox.textContent = '';
          messageBox.className = 'message-box'; 

          let message = '';
          let className = 'error';
          let loginSuccess = false;

          // Mock login validation: test@user.com / 12345
          if (email === '' || password === '') {
            message = 'Please fill in both email and password fields.';
            className = 'error';
          } else if (email === 'test@user.com' && password === '12345') {
            message = 'Authentication successful.';
            className = 'success';
            loginSuccess = true;
          } else {
            // Do not reveal test or temporary credentials to users
            message = 'Invalid credentials. Please check your email and password.';
            className = 'error';
          }

          messageBox.textContent = message;
          messageBox.classList.add('active', className);

          if (loginSuccess) {
            
            // PHASE 1: Wait 1000ms for user to read "Authentication successful."
            setTimeout(() => { 
                
                // 2. Hide the message box and the login card
                messageBox.classList.remove('active');
                loginCard.style.opacity = 0;
                loginCard.style.visibility = 'hidden';
                
                // 3. Show the final success message smoothly
                successDisplay.classList.add('visible');

                // Simulation: Keep the success message visible until the user closes it
                console.log("Login Successful. Displaying final screen.");


            }, 1000); // Wait 1 second to read the message

          } else {
             // Hide the error/info message after 5 seconds if not successful
             setTimeout(() => {
                messageBox.classList.remove('active');
             }, 5000);
          }
        });

    </script>
  </body>
</html>
