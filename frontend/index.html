<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Torii Security Tools</title>
  <link rel="preload" as="style" href="assets/css/main.css?v=2" />
  <link rel="stylesheet" href="assets/css/main.css?v=2" />
  <link rel="stylesheet" href="/assets/css/cyber-bg.css">
  <style>
    /* Fallback minimal styles (applies if external CSS didn't load) */
    :root{--bg:#f6f7fb;--fg:#0b1324;--muted:#6b7280;--card:#fff;--border:#e5e7eb}
    body{margin:0;font-family:system-ui,Arial,sans-serif;background:var(--bg);color:var(--fg)}
    a{color:inherit;text-decoration:none}
    .page{max-width:980px;margin:0 auto;padding:28px}
    .top{text-align:center;margin:20px 0 8px;position:relative}
    .top h1{font-size:40px;margin:0}
    .subtitle{color:var(--muted)}
    .search{display:flex;justify-content:center;margin:18px 0 28px}
    .search input{width:min(660px,100%);padding:12px 14px;border:1px solid var(--border);border-radius:10px}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:18px}
    .tile{display:flex;flex-direction:column;align-items:center;gap:12px;background:var(--card);border:1px solid var(--border);border-radius:16px;padding:22px}
    .icon{width:68px;height:68px;border-radius:50%;display:grid;place-items:center;font-size:30px;background:radial-gradient(100% 100% at 70% 20%, #fff 0%, #eaf6ff 100%);border:1px solid var(--border)}
    .label{font-weight:600}
    .foot{display:flex;gap:8px;justify-content:center;margin:26px 0;color:var(--muted)}
    .plain{color:var(--muted)}
    
    /* Profile dropdown styles */
    .profile-container{position:absolute;top:10px;right:10px;display:none}
    .profile-container.show{display:block}
    .login-btn{position:absolute;top:10px;right:10px;padding:8px 16px;background:#667eea;color:white;border-radius:20px;text-decoration:none;font-size:14px;font-weight:500;transition:all 0.2s;display:none}
    .login-btn.show{display:inline-block}
    .login-btn:hover{background:#5568d3;transform:translateY(-1px);box-shadow:0 4px 12px rgba(102,126,234,0.4)}
    .profile-btn{display:flex;align-items:center;gap:8px;padding:8px 12px;background:var(--card);border:1px solid var(--border);border-radius:20px;cursor:pointer;transition:all 0.2s}
    .profile-btn:hover{background:#f0f0f0;border-color:#999}
    .profile-avatar{width:32px;height:32px;border-radius:50%;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;display:grid;place-items:center;font-weight:600;font-size:14px}
    .profile-email{font-size:14px;color:var(--fg)}
    .profile-dropdown{position:absolute;top:50px;right:0;background:var(--card);border:1px solid var(--border);border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,0.1);min-width:200px;display:none;z-index:100}
    .profile-dropdown.show{display:block}
    .profile-dropdown a{display:block;padding:10px 16px;color:var(--fg);text-decoration:none;transition:background 0.2s}
    .profile-dropdown a:hover{background:var(--bg)}
    .profile-dropdown hr{margin:4px 0;border:none;border-top:1px solid var(--border)}
  /* Logo styling: keep clean ‚Äî no extra overlay/border */
  .pycyberdb-logo{width:72px;height:72px;object-fit:contain;border-radius:12px;border:none;box-shadow:none;background:transparent}
  </style>

  <!-- logo outline/filter removed to avoid overlay artifacts -->
  <meta name="color-scheme" content="light dark" />
  <link rel="icon" href="data:," />
  <meta name="description" content="Torii: a compact hub of security utilities (email analysis, URL scan, hash crack, SMS spam check, malware hash, and recon)." />
  <meta name="theme-color" content="#0ea5e9" />
  <meta name="robots" content="index,follow" />
</head>
<body class="home">
  <canvas id="cyber-canvas"></canvas>
  <div class="page">
    <header class="top">
      <!-- Login button (shows when logged out) -->
      <a href="/auth/login" id="loginBtn" class="login-btn">Login / Register</a>
      
      <!-- Profile indicator (shows when logged in) -->
      <div id="profileContainer" class="profile-container">
        <div class="profile-btn" onclick="toggleProfileDropdown()">
          <div class="profile-avatar" id="profileAvatar">U</div>
          <span class="profile-email" id="profileEmail">user@email.com</span>
        </div>
        <div id="profileDropdown" class="profile-dropdown">
          <a href="/profile.html">üë§ My Profile</a>
          <a href="/settings.html">‚öôÔ∏è Settings</a>
          <hr>
          <a href="/auth/logout">üö™ Logout</a>
        </div>
      </div>
      
        <div class="brand-inline" style="display:flex;align-items:center;gap:12px;justify-content:center">
          <img src="/assets/img/pycyberdb-logo.png" alt="pycyberdb logo" class="pycyberdb-logo" onerror="this.onerror=null; this.src='/assets/img/pycyberdb-logo.svg'" style="filter:url(#logo-outline);" />
          <h1 style="color:#ffffff; margin:0; font-size:40px">PyCyberDB</h1>
        </div>
      <p class="subtitle">Security tools at your fingertips</p>
    </header>

    <section class="search">
      <input id="toolSearch" type="search" placeholder="Search tools‚Ä¶ (email, url, hash, sms, malware, recon)" autocomplete="off" autofocus />
    </section>
    
    

    <section class="grid">
  <a class="tile" href="tool1-email-analyzer.html" data-tags="email message phishing">
        <span class="icon" aria-hidden="true">‚úâÔ∏è</span>
        <span class="label">Email Analyzer</span>
      </a>
  <a class="tile" href="tool2-url-scanner.html" data-tags="url link http https">
        <span class="icon" aria-hidden="true">üîó</span>
        <span class="label">URL Analyzer</span>
      </a>
  <a class="tile" href="tool3-password-cracker.html" data-tags="hash md5 sha password">
        <span class="icon" aria-hidden="true">üîë</span>
        <span class="label">Password Cracker</span>
        <p class="subtitle">Still working</p>
      </a>
  <a class="tile" href="tool4-sms-spam-tester.html" data-tags="sms message spam text">
        <span class="icon" aria-hidden="true">üì±</span>
        <span class="label">SMS Spam Tester</span>
      </a>
  <a class="tile" href="tool5-malware-analyzer.html" data-tags="file malware virus hash">
        <span class="icon" aria-hidden="true">ü¶†</span>
        <span class="label">Malware Analyzer</span>
      </a>
  <a class="tile" href="tool6-web-recon.html" data-tags="recon domain dns whois">
        <span class="icon" aria-hidden="true">üåê</span>
        <span class="label">Web Recon</span>
      </a>
  <a class="tile" href="tool-web-vuln-scanner.html" data-tags="scan vuln security web">
        <span class="icon" aria-hidden="true">üß≠</span>
        <span class="label">Web Vulnerability Scanner</span>
      </a>
  <a class="tile" href="tool7-stegoshield-inspector.html" data-tags="stego image steganography hidden data inspector" data-premium="true">
        <span class="icon" aria-hidden="true">üõ°Ô∏è</span>
        <span class="label">StegoShield Inspector</span>
      </a>
  <a class="tile" href="tool8-stegoshield-extractor.html" data-tags="stego extractor analysis threat detection malware" data-premium="true">
        <span class="icon" aria-hidden="true">üîç</span>
        <span class="label">StegoShield Extractor</span>
      </a>
  <a class="tile" href="tool9-dos-detector.html" data-tags="dos ddos traffic monitor">
        <span class="icon" aria-hidden="true">üö®</span>
        <span class="label">DoS Detector</span>
      </a>
    </section>

    
  </div>

  <script src="/assets/js/cyber-bg.js"></script>
  <script>
    (function(){
      const input = document.getElementById('toolSearch');
      if (!input) return;
      const tiles = Array.from(document.querySelectorAll('.tile'));
      const filter = () => {
        const q = input.value.trim().toLowerCase();
        tiles.forEach(t => {
          const text = t.textContent.toLowerCase();
          const tags = (t.dataset.tags || '').toLowerCase();
          const show = !q || text.includes(q) || tags.includes(q);
          t.style.display = show ? '' : 'none';
        });
      };
      input.addEventListener('input', filter);
    })();
    
    // Check user session and display profile
    async function checkUserSession() {
      try {
        const response = await fetch('/api/user-session');
        const data = await response.json();
        
        const profileContainer = document.getElementById('profileContainer');
        const profileEmail = document.getElementById('profileEmail');
        const profileAvatar = document.getElementById('profileAvatar');
        const authLinks = document.getElementById('authLinks');
        const loginBtn = document.getElementById('loginBtn');
        
        if (data.logged_in) {
          // User is logged in - show profile
          const firstLetter = (data.email || 'U')[0].toUpperCase();
          
          profileEmail.textContent = data.email;
          profileAvatar.textContent = firstLetter;
          profileContainer.classList.add('show');
          authLinks.style.display = 'none';
          loginBtn.classList.remove('show');

          // Apply premium visibility
          applyPremiumVisibility(data);
        } else {
          // User is logged out - show login button
          loginBtn.classList.add('show');
          profileContainer.classList.remove('show');
          authLinks.style.display = 'block';
          applyPremiumVisibility({logged_in:false});
        }
      } catch (error) {
        console.log('Session check failed:', error);
        // Default to logged out state
        document.getElementById('loginBtn').classList.add('show');
        document.getElementById('authLinks').style.display = 'block';
        applyPremiumVisibility({logged_in:false});
      }
    }
    
    // Toggle profile dropdown
    function toggleProfileDropdown() {
      const dropdown = document.getElementById('profileDropdown');
      dropdown.classList.toggle('show');
    }
    
    // Close dropdown when clicking outside
    document.addEventListener('click', function(event) {
      const profileBtn = document.querySelector('.profile-btn');
      const dropdown = document.getElementById('profileDropdown');
      if (profileBtn && dropdown && !profileBtn.contains(event.target) && !dropdown.contains(event.target)) {
        dropdown.classList.remove('show');
      }
    });
    
    // Check session on page load
    checkUserSession();

    function applyPremiumVisibility(session){
      const premiumTiles = Array.from(document.querySelectorAll('.tile[data-premium="true"]'));
      if (!session || !session.logged_in){
        premiumTiles.forEach(t => t.style.display = 'none');
        return;
      }
      const isPremium = !!session.is_premium;
      let allowed = [];
      try {
        if (typeof session.allowed_tools === 'string' && session.allowed_tools.trim().startsWith('[')){
          allowed = JSON.parse(session.allowed_tools);
        } else if (typeof session.allowed_tools === 'string'){
          allowed = session.allowed_tools.split(',').map(s => s.trim()).filter(Boolean);
        } else if (Array.isArray(session.allowed_tools)){
          allowed = session.allowed_tools;
        }
      } catch(e){ allowed = []; }
      const allowedSet = new Set(allowed);
      premiumTiles.forEach(t => {
        const href = (t.getAttribute('href')||'').trim();
        const can = isPremium || allowedSet.has(href) || allowedSet.has(href.replace(/^\/?/,''));
        t.style.display = can ? '' : 'none';
      });
    }

    // Coupon redemption moved to settings.html
  </script>
</body>
</html>
